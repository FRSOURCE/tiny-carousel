{"version":3,"file":"pluginScrollSnapFallback.js","sources":["../../../../packages/plugin-scroll-snap-fallback/src/useFallback.ts","../../../../packages/utils/dist/index.modern.js","../../../../packages/plugin-scroll-snap-fallback/src/index.ts"],"sourcesContent":["import type { TinyCarousel } from \"@frsource/tiny-carousel-core\";\nimport { on } from \"@frsource/tiny-carousel-utils\";\n\nexport const useFallback = (\n    carousel: Pick<TinyCarousel, 'items' | 'carouselElement'>,\n    config: { scrollTimeout?: number }\n  ) => {\n    // TODO: remove ignore when E2E test are in place\n    /* istanbul ignore next */\n    if (config.scrollTimeout === void 0) config.scrollTimeout = 45;\n\n    let timeoutId: number | undefined = void 0;\n    let initialScrollLeft: number | undefined = void 0;\n    let preventScrollEvent = 0;\n    // TODO: cover this method with tests\n    /* istanbul ignore next */\n    const timeoutedOnScroll = (e: Event) => {\n      if (--preventScrollEvent) return preventScrollEvent = 0;\n      initialScrollLeft = initialScrollLeft || (e.target as TinyCarousel['carouselElement']).scrollLeft;\n      clearTimeout(timeoutId);\n  \n      timeoutId = (setTimeout as Window['setTimeout'])(onScroll.bind(carousel, initialScrollLeft), config.scrollTimeout, e)\n    };\n  \n    on(carousel.carouselElement, 'scroll', timeoutedOnScroll, { passive: true });\n  \n    //\n    // TODO: cover this method with tests (Playwright/Puppeteer/cypress E2E?)\n    /* istanbul ignore next */\n    function onScroll (oldInitialScrollLeft: number, e: Event) {\n      initialScrollLeft = void 0;\n  \n      const scrollLeft = carousel.carouselElement.scrollLeft;\n      const children = [...carousel.items];\n      const direction = oldInitialScrollLeft > scrollLeft ? -1 : 0;\n      let offset = 0;\n      let elementToSnap: HTMLElement;\n      let elementToSnapOffsetWidth: number;\n  \n      do {\n        elementToSnap = children.shift() as HTMLElement;\n        elementToSnapOffsetWidth = elementToSnap.offsetWidth;\n        offset += elementToSnapOffsetWidth;\n      } while (children.length && offset + elementToSnapOffsetWidth < scrollLeft);\n  \n      preventScrollEvent = 2;\n      (e.target as TinyCarousel['carouselElement']).scrollLeft = offset + (direction * elementToSnapOffsetWidth);\n    }\n  };","const e=(e,t,n,s)=>{e.addEventListener(t,n,s)},t=(e,t,n)=>{e.removeEventListener(t,n)},n=(e,t,n,s)=>e.dispatchEvent(new CustomEvent(t,Object.assign({detail:n},s)));export{n as dispatch,t as off,e as on};\n//# sourceMappingURL=index.modern.js.map\n","import type { PluginDefinition } from \"@frsource/tiny-carousel-core\";\nimport { useFallback } from \"./useFallback\";\n\nexport const pluginScrollSnapFallback = {\n  install: (instance, config = {}) => {\n    if (\n      config.force || \n      !(\n        // if does not support modern scroll-snap API\n        typeof CSS !== 'undefined' && CSS.supports?.('scroll-snap-align', 'start') || \n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        typeof InstallTrigger !== 'undefined' // or is not Firefox, based on https://stackoverflow.com/a/9851769\n      )\n    ) useFallback(instance, config);\n  }\n} as PluginDefinition<[{ force?: boolean; scrollTimeout?: number }?]>;\n"],"names":["useFallback","carousel","config","scrollTimeout","timeoutId","initialScrollLeft","preventScrollEvent","onScroll","oldInitialScrollLeft","e","elementToSnapOffsetWidth","scrollLeft","carouselElement","children","items","direction","offset","shift","offsetWidth","length","target","addEventListener","clearTimeout","setTimeout","bind","passive","install","instance","force","CSS","supports","InstallTrigger"],"mappings":"kQAGaA,EAAc,SACvBC,EACAC,QAI6B,IAAzBA,EAAOC,gBAA0BD,EAAOC,cAAgB,IAE5D,IAAIC,OAAgC,EAChCC,OAAwC,EACxCC,EAAqB,EAgBzB,SAASC,EAAUC,EAA8BC,GAC/CJ,OAAoB,EAEpB,IAKIK,EALEC,EAAaV,EAASW,gBAAgBD,WACtCE,YAAeZ,EAASa,OACxBC,EAAYP,EAAuBG,GAAc,EAAI,EACvDK,EAAS,EAIb,GAGEA,GADAN,EADgBG,EAASI,QACgBC,kBAElCL,EAASM,QAAUH,EAASN,EAA2BC,GAEhEL,EAAqB,EACpBG,EAAEW,OAA2CT,WAAaK,EAAUD,EAAYL,EAtBhFT,EAASW,gBCNPS,iBDMwB,SARH,SAACZ,GACzB,KAAMH,EAAoB,OAAOA,EAAqB,EACtDD,EAAoBA,GAAsBI,EAAEW,OAA2CT,WACvFW,aAAalB,GAEbA,EAAamB,WAAoChB,EAASiB,KAAKvB,EAAUI,GAAoBH,EAAOC,cAAeM,IAG3D,CAAEgB,SAAS,gCErBjC,CACtCC,QAAS,SAACC,EAAUzB,YAAAA,IAAAA,EAAS,KAEzBA,EAAO0B,QAGU,oBAARC,WAAuBA,IAAIC,UAAJD,IAAIC,SAAW,oBAAqB,UAGxC,oBAAnBC,iBAET/B,EAAY2B,EAAUzB"}